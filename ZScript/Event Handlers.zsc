class PlayerSpawnLines : StaticEventHandler
{
    override void WorldLoaded(WorldEvent _event)
    {
        if (_event.IsSaveGame) return;
        
        let player = players[consoleplayer].mo;
        player.A_StartSound("player/battlecry", CHAN_VOICE);
    }
    
    override void PlayerRespawned(PlayerEvent _event)
    {
        let player = players[_event.playernumber].mo;
        player.A_StartSound("player/respawn", CHAN_VOICE);
    }
}

class ThingReplacer : StaticEventHandler
{
    override void CheckReplacement(ReplaceEvent e)
    {
		// Monsters
        CVar replaceMonsters = CVar.FindCVar('gwm_replacemonsters');
		CVar noAltReplacements = CVar.FindCVar('gwm_noaltreplacements');
        if (replaceMonsters.GetBool())
        {
			if (noAltReplacements.GetBool())
			{
				// Hitscanners
				if (e.Replacee == "ZombieMan")
					e.Replacement = "GWM_Zombieman";
				if (e.Replacee == "ShotgunGuy")
					e.Replacement = "GWM_KahunaShotgunGuy";
				if (e.Replacee == "ChaingunGuy")
					e.Replacement = "GWM_ChaingunGuy";
				// Imps and Bigger Imps
				if (e.Replacee == "DoomImp")
					e.Replacement = "GWM_DoomImp";
				if (e.Replacee == "HellKnight")
					e.Replacement = "GWM_HellKnight";
				if (e.Replacee == "BaronOfHell")
					e.Replacement = "GWM_BaronOfHell";
				// Misc
				if (e.Replacee == "Demon")
					e.Replacement = "GWM_Pinky";
				if (e.Replacee == "Cyberdemon")
					e.Replacement = "GWM_Cyberdemon";
				if (e.Replacee == "Cacodemon")
					e.Replacement = "GWM_Cacodemon";
				if (e.Replacee == "LostSoul")
					e.Replacement = "GWM_LostSoul";
			}
			else
			{
				// Hitscanners
				if (e.Replacee == "ZombieMan")
				{
					if (random(0, 3) == 3)
						e.Replacement = "GWM_SMGGuy";
					else
						e.Replacement = "GWM_Zombieman";
				}
				if (e.Replacee == "ShotgunGuy")
				{
					if (random(0, 3) == 3)
						e.Replacement = "GWM_IceShotgunGuy";
					else
						e.Replacement = "GWM_KahunaShotgunGuySpawner"; // to spawn a Kahuna Shotgun Guy or a Shadow Hunter
				}
				if (e.Replacee == "ChaingunGuy")
				{
					if (random(0, 1) == 1)
						e.Replacement = "GWM_HeavyRifleman";
					else
						e.Replacement = "GWM_ChaingunGuy";
				}
				// Imps and Bigger Imps
				if (e.Replacee == "DoomImp")
				{
					switch (random(0,4))
					{
						case 4:
							e.Replacement = "GWM_NightmareImpSpawner"; // to spawn a Nightmare Imp or a Nightshade
							break;
						case 3:
							e.Replacement = "GWM_CyberImp";
							break;
						default:
							e.Replacement = "GWM_DoomImp";
					}
				}
				if (e.Replacee == "HellKnight")
					e.Replacement = "GWM_HellKnight";
				if (e.Replacee == "BaronOfHell")
					e.Replacement = "GWM_BaronOfHell";
				// Misc
				if (e.Replacee == "Demon")
				{
					if (random(0, 4) == 4)
						e.Replacement = "GWM_Hellhog";
					else
						e.Replacement = "GWM_Pinky";
				}
				if (e.Replacee == "Cyberdemon")
				{
					if (random(0,1) == 1)
						e.Replacement = "GWM_Superdemon";
					else
						e.Replacement = "GWM_Cyberdemon";
				}
				if (e.Replacee == "Cacodemon")
					e.Replacement = "GWM_Cacodemon";
				if (e.Replacee == "LostSoul")
					e.Replacement = "GWM_LostSoulSpawner"; // to spawn a Lost Soul or a Blot
			}
        }

		// Objects
        CVar replaceObjects = CVar.FindCVar('gwm_replaceobjects');
		if (replaceObjects.getBool())
		{
			if (e.Replacee == "ExplosiveBarrel")
				e.Replacement = "GWM_ExplosiveBarrel";
		}

		// Weapons & Ammo
		if (noAltReplacements.GetBool())
		{
			if (e.Replacee == "Chainsaw")
				e.Replacement = "GWM_Lumberjack";
			if (e.Replacee == "Pistol")
				e.Replacement = "GWM_Pistol";
			if (e.Replacee == "Shotgun")
				e.Replacement = "GWM_Shotgun";
			if (e.Replacee == "SuperShotgun")
				e.Replacement = "GWM_SuperShotgun";
			if (e.Replacee == "Chaingun")
				e.Replacement = "GWM_Chaingun";
			if (e.Replacee == "RocketLauncher")
				e.Replacement = "GWM_RocketLauncher";
			if (e.Replacee == "PlasmaRifle")
				e.Replacement = "GWM_PlasmaRifle";
			if (e.Replacee == "BFG9000")
				e.Replacement = "GWM_BFG9000";
			// No Clip replacement because the chaingun requires high-cal, but the pistol requires low-cal
			if (e.Replacee == "Shell")
				e.Replacement = "GWM_Shell";
			if (e.Replacee == "ShellBox")
				e.Replacement = "GWM_ShellBox";
			if (e.Replacee == "RocketAmmo")
				e.Replacement = "GWM_RocketAmmo";
			if (e.Replacee == "RocketBox")
				e.Replacement = "GWM_RocketBox";
			if (e.Replacee == "Cell")
				e.Replacement = "GWM_Cell";
			if (e.Replacee == "CellPack")
				e.Replacement = "GWM_CellPack";
		}

		// Weapons from other mapsets... The only thing here right now is from Eviternity II.
		// check if the class exists first
		string ev2perfstr = "Perforator";
		class<Actor> ev2perf = ev2perfstr;
		if (ev2perf) // check if it exists for real
		{
			if (e.Replacee == ev2perf)
				e.Replacement = "GWM_Perforator";
		}
    }
	override void CheckReplacee(ReplacedEvent e)
	{
		if (e.Replacement == "GWM_BaronOfHell")
			e.Replacee = "BaronOfHell";
		if (e.Replacement == "GWM_Cyberdemon")
			e.Replacee = "Cyberdemon";
		if (e.Replacement == "GWM_Superdemon")
			e.Replacee = "Cyberdemon";
	}
}